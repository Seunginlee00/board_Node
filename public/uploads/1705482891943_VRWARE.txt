[VRWARE 설정 사항]
0. 로그인 정보
 - URL : https://www.nhncloud.com
 - ID : toast@globepoint.co.kr
 - PW : globe2580**

1. 서버사양
 - 4vcore 8GB
 - OS : Ubuntu Server 20.04 LTS
 - IP : 192.168.0.48 / 125.6.37.155
 - VM : V2.VRWARE

2. 도메인
 - localhost
 - v2admin.vrware.us

3. 참고사이트
 - 서버설정 : https://blog.lael.be/post/11072
 - CodeIgniter 설치 : https://www.howtoforge.com/tutorial/ubuntu-codeigniter/

4. 서버세팅

비 필수적인 캐시 메모리를 정리하기
# sync && echo 3 > /proc/sys/vm/drop_caches

Timezone 설정하기
# dpkg-reconfigure tzdata

SWAP 추가 스크립트를 사용하여 서버에 1GB 의 가상 메모리 설정하기
# wget -q https://raw.githubusercontent.com/laelbe/linux-simple-scripts/main/_server_tools/add_swapfile -O /root/add_swapfile
# bash /root/add_swapfile 1

패키지 목록 갱신
# apt update

현재 운영체제에 설치되어있는 프로그램 최신버전 패치
# apt upgrade

업데이트 과정중에 생긴 찌꺼기 파일이 있으면 제거.
# apt autoremove

재부팅
# reboot

Apache2 설치
# apt install apache2 : Server version: Apache/2.4.41 (Ubuntu)

https 인증서 관련 프로그램 설치
# apt install ssl-cert

무료 인증서 발급 프로그램 설치
# apt install certbot

기본 Apache2 Module 활성화
# a2enmod rewrite
# a2enmod headers
# a2enmod ssl
# a2dismod -f autoindex

변경사항 적용
# systemctl restart apache2

기본 언어셋 변경
# vi /etc/apache2/conf-available/charset.conf  : 기본 언어값 UTF-8 에 대해서 주석(#) 제거

추가 보안 설정
# vi /etc/apache2/conf-available/security.conf

    <Directory />
    AllowOverride None
    Require all denied
    </Directory>

    ServerTokens Prod

    ServerSignature Off

    TraceEnable Off

    Header set X-Content-Type-Options: "nosniff"

    Header set X-Frame-Options: "sameorigin"


추가 보안패치. (.git, .svn, .env 등 dot로 시작하는 파일 및 폴더 보호, Web Access가 되어서는 안될 파일들의 접근 제어)
# vi /etc/apache2/apache2.conf

    파일 중간(약 199번째 줄)의 <FilesMatch “^\.ht”> 구문 다음에 추가 (199G 입력)
    # deny file, folder start with dot
    <DirectoryMatch "^\.|\/\.">
        Require all denied
    </DirectoryMatch>
    
    # deny (log file, binary, certificate, shell script, sql dump file) access.
    <FilesMatch "\.(?i:log|binary|pem|enc|crt|conf|cnf|config|sql|sh|key|yml|lock|bak|gitignore)$">
        Require all denied
    </FilesMatch>
    
    # deny access.
    <FilesMatch "(?i:composer\.json|contributing\.md|license\.txt|readme\.rst|readme\.md|readme\.txt|copyright|artisan|gulpfile\.js|package\.json|phpunit\.xml|access_log|error_log|gruntfile\.js|bower\.json|changelog\.md|console|legalnotice|license|security\.md|privacy\.md)$">
        Require all denied
    </FilesMatch>
    
    # Allow Lets Encrypt Domain Validation Program
    <DirectoryMatch "\.well-known/acme-challenge/">
        Require all granted
    </DirectoryMatch>
    
    # Block .php file inside upload folder. uploads(wp), files(drupal), data(gnuboard).
    <DirectoryMatch "/(uploads|default/files|data|wp-content/themes)/">
        <FilesMatch ".+\.php$">
            Require all denied
        </FilesMatch>
    </DirectoryMatch>
    
    <DirectoryMatch "/(data/session)/">
        Require all denied
    </DirectoryMatch>

변경사항 적용
# service apache2 restart

Apache 개별 사용자 권한 설정
# apt-cache search mpm-itk
# apt install libapache2-mpm-itk
# chmod 711 /home
# chmod -R 700 /home/*

변경사항 적용
# service apache2 restart

기본사이트 추가 설정
# vi /etc/apache2/sites-available/000-default.conf
    ServerName localhost 추가

HTTPS 기본사이트 켜기
# mv /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-available/000-default-ssl.conf
# vi /etc/apache2/sites-available/000-default-ssl.conf
     ServerName localhost 추가
# a2ensite 000-default-ssl.conf

설정 적용
# service apache2 reload

PHP 설치
# apt install php : PHP 7.4.3-4ubuntu2.19 (cli) (built: Jun 27 2023 15:49:59) ( NTS )

다국어 처리모듈
# apt install php-mbstring

이미지 처리모듈
# apt install php-gd

원격지 정보 불러는 모듈 (워드프레스 등에서 쓰임)
# apt install php-curl php-xml

수학 연산 확장 모듈
# apt install php-bcmath

OAuth 인증 모듈 (클라우드 API 등 연동서비스에서 쓰임)
# apt install php-oauth

MySQL 연동 모듈 (mysqli, pdo-mysql 관련 함수를 사용할 수 있게됨)
# apt install php-mysql

Composer 설치 (PHP 패키지 의존성 관리 프로그램)
# apt install composer

PHP 보안 설정
# vi /etc/apache2/mods-available/php7.4.conf : 적당한 위치에 아래 구문 추가

    <FilesMatch ".+\.ph(p3|p4|p5|p7|ar|t|tml)$">
        Require all denied
    </FilesMatch>

적용을 위해서 아파치 재시작
# service apache2 restart


PHP Default timezone 설정
# vi /etc/php/7.4/apache2/php.ini : Asia/Seoul 입력

cron이나 console에서 PHP를 실행할때 참조하는 파일, 동일하게 timezone 을 설정해 주세요.
# vi /etc/php/7.4/cli/php.ini

변경사항 적용하기
# service apache2 restart

HTML 경로
/var/www/html/

phpmyadmin 설치 : http://125.6.37.155/dbmyadmin/
# wget https://files.phpmyadmin.net/phpMyAdmin/5.1.3/phpMyAdmin-5.1.3-all-languages.zip -O /var/www/html/dbmyadmin.zip.lock
# cd /var/www/html && unzip dbmyadmin.zip.lock && mv phpMyAdmin-5.1.3-all-languages dbmyadmin

phpmyadmin 웹소프트웨어의 환경
# mv /var/www/html/dbmyadmin/config.sample.inc.php /var/www/html/dbmyadmin/config.inc.php
# vi /var/www/html/dbmyadmin/config.inc.php
    - 전체 내용 삭제후 아래 내역 붙여넣기

    declare(strict_types=1);
 
    $valid_passwords = ['gpuser' => 'globe132#', 'gpkwak' => 'rmffhqm!!'];
    $valid_users = array_keys($valid_passwords);
    $user = $_SERVER['PHP_AUTH_USER'];
    $pass = $_SERVER['PHP_AUTH_PW'];
    $validated = (in_array($user, $valid_users)) && ($pass == $valid_passwords[$user]);
    if (!$validated) {
        header('WWW-Authenticate: Basic realm="password?"');
        header('HTTP/1.0 401 Unauthorized');
        die ("Not authorized");
    }
    
    $cfg['blowfish_secret'] = 'RkyE=T6t6KjX65KPC7/XNQ\Bk9EhBXar'; /* YOU MUST FILL IN THIS FOR COOKIE AUTH! */
    $cfg['NavigationTreeEnableGrouping'] = false;
    $cfg['MaxNavigationItems'] = '200';
    $cfg['FirstLevelNavigationItems'] = '200';
    $cfg['ShowDatabasesNavigationAsTree'] = false;
    $cfg['NumRecentTables'] = 0;
    
    /**
    * Servers configuration
    */
    $i = 0;
    
    $i++;
    $cfg['Servers'][$i]['host'] = 'localhost';
    $cfg['Servers'][$i]['port'] = '3306';

일반 사용자 계정 생성
# adduser gpuser (rmffhqm132!! / 글로브132!!)

웹루트생성
# su -l gpuser
# mkdir www
# exit

웹사이트 Apache 환경설정파일 작성

# cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/v2admin.vrware.us.conf
# cp /etc/apache2/sites-available/000-default-ssl.conf /etc/apache2/sites-available/v2admin.vrware.us-ssl.conf

    //---- 80 만 사용할 경우 -------------
    <VirtualHost *:80>
        ServerName vrware.us
        ServerAlias v2admin.vrware.us

        DocumentRoot /home/gpuser/www

        <Directory /home/gpuser/www>
            Options FollowSymLinks MultiViews
            AllowOverride All
            require all granted

            php_value upload_max_filesize 10M
            php_value post_max_size 10M

            php_value session.cookie_httponly 1
            php_value session.use_strict_mode 1

            php_value memory_limit 128M
            php_value max_execution_time 30
            php_value max_input_time 60
        </Directory>

        AssignUserID gpuser gpuser

        ErrorLog ${APACHE_LOG_DIR}/vrware.us-error.log
        CustomLog ${APACHE_LOG_DIR}/vrware.us-access.log combined

    </VirtualHost>

    //------ 443 포트를 사용할 경우 ----------------------------
    <VirtualHost *:80>
        ServerName vrware.us
        ServerAlias v2admin.vrware.us

        <IfModule mod_rewrite.c>
        RewriteEngine on

        RewriteRule ^ - [E=protossl]
        RewriteCond %{HTTPS} on
        RewriteRule ^ - [E=protossl:s]

        RewriteCond %{HTTPS} !=on
        RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

        </IfModule>

    </VirtualHost>

    # Specify the SSL cache directory. If possible, use shmcb, otherwise use the provided path.
    SSLStaplingCache shmcb:/var/run/ocsp(128000)

    <VirtualHost *:443>
        ServerName vrware.us
        ServerAlias v2admin.vrware.us
        
        DocumentRoot /home/gpuser/www

        <Directory /home/gpuser/www>
            Options FollowSymLinks MultiViews
            AllowOverride All
            require all granted

            php_value upload_max_filesize 10M
            php_value post_max_size 10M

            php_value session.cookie_httponly 1
            php_value session.use_strict_mode 1

            # php_value memory_limit 128M
            # php_value max_execution_time 30
            # php_value max_input_time 60
        </Directory>

        AssignUserID gpuser gpuser

        ErrorLog ${APACHE_LOG_DIR}/vrware.us-error.log
        CustomLog ${APACHE_LOG_DIR}/vrware.us-access.log combined

        SSLEngine on

        SSLProtocol all -SSLv2 -SSLv3

        SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA

        SSLHonorCipherOrder on
        SSLCertificateFile  /etc/ssl/certs/ssl-cert-snakeoil.pem
        SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

        # Turn on OCSP stapling
        SSLUseStapling on
        SSLStaplingResponderTimeout 5
        SSLStaplingReturnResponderErrors off

    </VirtualHost>



사이트 켜기
# a2ensite vrware.us.conf
# a2ensite vrware.us-ssl.conf

사이트 끄기
# a2dissite vrware.us.conf
# a2dissite vrware.us-ssl.conf

변경사항 적용
# service apache2 reload

MYSQL 설치 
# apt install mysql-server : Server version 8.0.35-0ubuntu0.20.04.1

설치된 버전 확인
# mysqladmin version

기본 관리자 비밀번호 확인
# cat /etc/mysql/debian.cnf

[client]
host     = localhost
user     = debian-sys-maint
password = SDydpcmWMNBNGddR
socket   = /var/run/mysqld/mysqld.sock
[mysql_upgrade]
host     = localhost
user     = debian-sys-maint
password = SDydpcmWMNBNGddR
socket   = /var/run/mysqld/mysqld.sock

// 사용계정 : vrware / rmffhqm#132

Root : /var/www/html/


PHP.ini 설정변경 (중복????)
# vi /etc/php/7.4/apache2/php.ini (curl, intl 부분의 앞 ; 주석 해제)

CodeIgniter3 다운로드
# wget https://github.com/bcit-ci/CodeIgniter/archive/3.1.5.zip 

압축해제 및 디렉토리 이동
# unzip 3.1.5.zip -d /var/www/html
# cp -r CodeIgniter-3.1.5 /var/www/html/codeigniter

권한 변경
# chown -R www-data:www-data /var/www/html/codeigniter
# chmod -R 777 /var/www/html/codeigniter/

환경설정
# vi /etc/apache2/sites-available/codeigniter.conf

<VirtualHost *:80>
    ServerAdmin admin@yourdomain.com
    DocumentRoot /var/www/html/codeigniter
    ServerName localhost
    <Directory /var/www/html/codeigniter/>
    Options +FollowSymLinks
    AllowOverride All
    Order allow,deny
    allow from all
    </Directory>
    ErrorLog /var/log/apache2/codeigniter-error_log
    CustomLog /var/log/apache2/codeigniter-access_log common
</VirtualHost>

CodeIgniter 세팅
# cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/codeigniter.conf
# vi /etc/apache2/sites-available/codeigniter.conf

    <VirtualHost *:80>
        ServerAdmin webmaster@localhost
        ServerName localhost

        DocumentRoot /var/www/html/CodeIgniter/public/

        <Directory /var/www/html/CodeIgniter/public/> 
            Options FollowSymLinks
            AllowOverride All
            Order allow,deny
            Allow from all
        </Directory> 

        ErrorLog /var/log/apache2/${APACHE_LOG_DIR}-error_log
        CustomLog /var/log/apache2/${APACHE_LOG_DIR}-access_log common

    </VirtualHost>

사이트 속성 등록 (끄기)
# a2ensite codeigniter.conf
# a2dissite codeigniter.conf

재시작
# systemctl restart apache2

구글연동 라이브러리 추가
composer require google/apiclient:^2.0

# a2ensite 000-default.conf
# a2dissite 000-default.conf

# a2ensite 000-default-ssl.conf
# a2dissite 000-default-ssl.conf

//포트 확인
netstat -tnlp

//포트 추가 
# vi /etc/apache2/ports.conf
# systemctl restart apache2


// Install Composer
curl -sS https://getcomposer.org/installer | php

// Install loginradius
composer require loginradius/php-sdk:11.5.0

// Install JWK
composer require strobotti/php-jwk

// ------------------------------------------- 데이터베이스 설계 ---------------------------------------------
//테이블 리스트

콘텐츠등록 테이블 : TB_CONTENTS_MST
콘텐츠등록 상세 테이블 : TB_CONTENTS_DTL
콘텐츠등록 첨부이미지 테이블 : TB_CONTENTS_IMAGES
콘텐츠카테고리 테이블 : TB_CONTENTS_CATEGORY
라이선스코드 테이블 : TB_LICENSE_CODE
라이선스코드 발급내역 테이블 : TB_LICENSE_HST
홈페이지메뉴관리 테이블 : TB_ADMIN_MENU
관리자 테이블 : TB_ADMIN_MST
관리자 히스토리 테이블 : TB_ADMIN_HST
환경설정 테이블 : TB_USED_CONFIG
회원마스터 테이블 : TB_MEMBER_MST
회원히스토리 테이블 : TB_MEMBER_HST
회원그룹 테이블 : TB_MEMBER_GROUP
학교정보 테이블 : TB_SCHOOL_MST
상품 테이블 : TB_PRODUCT_MST
상품카테고리 테이블 : TB_PRODUCT_CATEGORY
상품재고 테이블 : TB_PRODUCT_STOCK
상품옵션 테이블 : TB_PRODUCT_OPTION
주문 테이블 : TB_ORDER
배송 테이블 : TB_ORDER_DELIVERY
관리자메모 테이블 : TB_ADMIN_MEMO
게시판 테이블 : TB_BOARD_LIST
게시판 코멘트 테이블 : TB_BOARD_COMMENT
게시판설정 테이블 : TB_BOARD_CATEGORY
메시지발송 테이블 : TB_MESSAGE_SEND_HST
팝업 테이블 : TB_POPUP
통계 테이블 : TB_STATISTICS
약관 테이블 : TB_TERMS_MST
접근제어 테이블 : TB_ACCESS_LST
공통 마스터코드 테이블 : TB_CODE_MST

// 공통 마스터코드 테이블 : TB_CODE_MST
CREATE TABLE IF NOT EXISTS `TB_CODE_MST` (
	`code_idx` INT(10) NOT NULL AUTO_INCREMENT,
	`code_gcode` VARCHAR(20) NULL DEFAULT NULL COMMENT '구분코드',
    `code_scode` VARCHAR(20) NULL DEFAULT NULL COMMENT '서브코드',
    `code_name` VARCHAR(100) NULL DEFAULT NULL COMMENT '한글코드이름',
    `code_name_eng` VARCHAR(100) NULL DEFAULT NULL COMMENT '영문코드이름',
    `code_txt` TEXT NULL DEFAULT NULL COMMENT '코드 요약내용',
    `code_reg_ip` varchar(15) DEFAULT NULL COMMENT '등록아이피',
	`code_reg_date` TIMESTAMP NOT NULL DEFAULT current_timestamp() COMMENT '등록 일시',
	`code_del_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
	PRIMARY KEY (`code_idx`),
	INDEX `code_code` (`code_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='마스터코드';
-- 제조사, 제조국, 

제조사 : 글로브포인트, ???
제조국 : 대한민국, 미국, 중국, 일본, 대만, 베트남 ???
지원언어 : 한국어, 영어, 일본어, 베트남어 ???
기술구분 : AR, VR, XR, ???
디바이스 : ALL, PC, HMD, JOYSTICK, 태블릿, ???
발달영역 : 언어, 창의력, 상상력, 소통, ???
개발프로그램 : 유니티, ???
파일타입 : exe, ppk ???
과목 : 국어, 영어, 과학, 수학, ???
사용구분 : 안전, 미래직업, 실험, 스포츠(태권도), 실습(간호술기), 게임, ???
기능구분 : 스토리창작, 그림창작, 스티커꾸미기, 배경음악, 뷰어모드, 말풍선꾸미기, 목소리녹음, VR모드, ???
서비스(제품) : VRWARE, VRWARE EDU SCHOOL, VRWARE BOOKCLUB, VRWARE STORYMAKER, VRWARE STORYBUILDER, META CLASSROOM, METAWARE, VRWARE METAVERSE, METACUBE
학생구분 : 미취학, 유치원, 초등학교, 중학교, 고등학교, 대학교, 대학원, 교육원, 학점은행, 기타
학년 : 1학년, 2학년, 3학년, 4학년, 5학년, 6학년, 7학년, 8학년, 9학년, 10학년
반 : 1반, 2반, ~ 50반
사용기간 : 영구, 기간, 임시
사용처 : 교육용, 가정용, 기업용
공급형태 : 패키지, 볼륨, 다운로드, 번들
업그레이드 : 처음사용자, 업그레이드, 다운그레이드
공개여부 : 상용, 셰어, 프리
사용방법 : 설치형, 온라인, 플러그인
개발년도 : 2018년 이전, 2019년, 2020년, 2021년, 2022년, 2023년, 2024년


// 콘텐츠등록 테이블 : TB_CONTENTS_MST
CREATE TABLE IF NOT EXISTS `TB_CONTENTS_MST` (
	`contents_idx` INT(10) NOT NULL AUTO_INCREMENT,
	`contents_category_idx` INT(10) NULL DEFAULT NULL COMMENT '카테고리고유값(TB_CONTENTS_CATEGORY.contents_category_idx)',
	`contents_code` VARCHAR(20) NULL DEFAULT NULL COMMENT '콘텐츠 고유코드',
    `contents_title` VARCHAR(255) NULL DEFAULT NULL COMMENT '콘텐츠 이름',
    `contents_used_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
    `contents_admin_idx` INT(10) NULL DEFAULT NULL COMMENT '등록자명(TB_ADMIN_MST.admin_idx)',
    `contents_reg_ip` varchar(15) DEFAULT NULL COMMENT '등록아이피',
	`contents_reg_date` TIMESTAMP NOT NULL DEFAULT current_timestamp() COMMENT '등록 일시',
    `contents_mod_date` TIMESTAMP NULL DEFAULT NULL COMMENT '수정 일시',
	`contents_del_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
	PRIMARY KEY (`contents_idx`),
	INDEX `contents_del_YN` (`contents_del_YN`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='콘텐츠등록 마스터';

// 콘텐츠등록 상세 테이블 : TB_CONTENTS_DTL
CREATE TABLE IF NOT EXISTS `TB_CONTENTS_DTL` (
	`contents_dtl_idx` INT(10) NOT NULL AUTO_INCREMENT,
	`contents_idx` INT(10) NULL DEFAULT NULL COMMENT '콘텐츠고유값(TB_CONTENTS_MST.contents_idx)',
    `contents_dtl_shot_txt` TEXT NULL DEFAULT NULL COMMENT '콘텐츠 요약내용',
    `contents_dtl_txt` LONGTEXT NULL DEFAULT NULL COMMENT '콘텐츠 상세내용',


	품명 및 모델명
    사용가능제품(서비스)
    서비스타입
    키워드
    디바이스
    사용연령
    파일크기
    파일타입
    제작사
    개발언어



    `contents_dtl_nicname` VARCHAR(100)  NOT NULL DEFAULT '닉네임없음' COMMENT '회원 닉네임',
    `contents_dtl_password` VARCHAR(50) NOT NULL DEFAULT '' COMMENT '회원 비밀번호',
    `contents_dtl_phone` VARCHAR(20) NULL DEFAULT NULL COMMENT '회원 연락처',
    `contents_dtl_join_gubun` ENUM('W','G','A','E') NOT NULL DEFAULT 'W' COMMENT '가입구분 (W:웹가입, G:구글가입, A:애플가입, E:기타예비)',
    `contents_dtl_gubun` ENUM('S','A','N','G') NOT NULL DEFAULT 'N' COMMENT '관리자구분 (S:슈퍼관리자, A:일반관리자, N:일반회원, G:게스트회원)',
    
    `contents_dtl_reg_ip` varchar(15) DEFAULT NULL COMMENT '등록아이피',
	`contents_dtl_reg_date` TIMESTAMP NOT NULL DEFAULT current_timestamp() COMMENT '가입일시',
    `contents_dtl_del_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
	PRIMARY KEY (`contents_dtl_idx`),
	INDEX `contents_dtl_del_YN` (`contents_dtl_del_YN`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='콘텐츠등록 상세';

// 콘텐츠등록 첨부이미지 테이블 : TB_CONTENTS_IMAGES
CREATE TABLE IF NOT EXISTS `TB_CONTENTS_IMAGES` (
	`contents_images_idx` INT(10) NOT NULL AUTO_INCREMENT,
    `contents_idx` INT(10) NULL DEFAULT NULL COMMENT '콘텐츠고유값(TB_CONTENTS_MST.contents_category_idx)',
	`contents_images_file` varchar(255) DEFAULT NULL COMMENT '파일경로',
    `contents_images_name` varchar(255) DEFAULT NULL COMMENT '파일이름',
	`contents_images_reg_ip` varchar(15) DEFAULT NULL COMMENT '등록아이피',
	`contents_images_reg_date` TIMESTAMP NOT NULL DEFAULT current_timestamp() COMMENT '가입일시',
    `contents_images_del_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
	PRIMARY KEY (`contents_images_idx`),
	INDEX `contents_images_del_YN` (`contents_images_del_YN`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='콘텐츠등록 첨부이미지';

// 콘텐츠카테고리 테이블 : TB_CONTENTS_CATEGORY
CREATE TABLE IF NOT EXISTS `TB_CONTENTS_CATEGORY` (
	`contents_category_idx` INT(10) NOT NULL AUTO_INCREMENT,
    `contents_category_parents` INT(10) NOT NULL DEFAULT '0' COMMENT '카테고리 상위 고유번호',
    `contents_category_depth` INT(10) NOT NULL DEFAULT '1' COMMENT '카테고리 DEPTH',
    `contents_category_sort` INT(10) NOT NULL DEFAULT '1' COMMENT '카테고리 순서',
	`contents_category_code` VARCHAR(10) NULL DEFAULT NULL COMMENT '카테고리 코드',
    `contents_category_name` VARCHAR(255) NULL DEFAULT NULL COMMENT '카테고리 이름',
    `contents_category_reg_ip` varchar(15) DEFAULT NULL COMMENT '등록아이피',
	`contents_category_reg_date` TIMESTAMP NOT NULL DEFAULT current_timestamp() COMMENT '가입일시',
	`contents_category_del_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
	PRIMARY KEY (`contents_category_idx`),
	INDEX `contents_category_del_YN` (`contents_category_del_YN`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='콘텐츠카테고리';


// 라이선스코드 테이블 : TB_LICENSE_CODE
CREATE TABLE IF NOT EXISTS `TB_LICENSE_CODE` (
	`license_idx` INT(10) NOT NULL AUTO_INCREMENT,
	`license_code` VARCHAR(10) NULL DEFAULT NULL COMMENT '라이선스코드',
	`license_name` VARCHAR(100)  NOT NULL DEFAULT '이름없음' COMMENT '라이선스명',
	`license_gubun` ENUM('A','B','C','D','E') NOT NULL DEFAULT 'W' COMMENT '라이선스구분 (A:, B:, C:, D: )',
    `license_period` VARCHAR(10)  NOT NULL DEFAULT '2999-12-31' COMMENT '라이선스사용기간',
    `license_used_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
    `admin_idx` INT(10) NOT NULL DEFAULT '1' COMMENT '발급자 아이디',
    `license_reg_ip` varchar(15) DEFAULT NULL COMMENT '등록아이피',
	`license_reg_date` TIMESTAMP NOT NULL DEFAULT current_timestamp() COMMENT '가입일시',
    `license_del_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
	PRIMARY KEY (`license_idx`),
	INDEX `license_del_YN` (`license_del_YN`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='라이선스코드';

// 라이선스코드 발급내역 테이블 : TB_LICENSE_HST
CREATE TABLE IF NOT EXISTS `TB_LICENSE_HST` (
	`license_hst_idx` INT(10) NOT NULL AUTO_INCREMENT,
    `license_idx` INT(10) NOT NULL DEFAULT '1' COMMENT '라이선스코드 고유값(TB_LICENSE_CODE.license_idx)',
    `member_idx` INT(10) NOT NULL DEFAULT '1' COMMENT '사용자 아이디 고유값(TB_MEMBER.member_idx)',
    `license_hst_reg_ip` varchar(15) DEFAULT NULL COMMENT '등록아이피',
	`license_hst_reg_date` TIMESTAMP NOT NULL DEFAULT current_timestamp() COMMENT '등록일시',
	`license_hst_del_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
	PRIMARY KEY (`license_hst_idx`),
	INDEX `member_del_YN` (`member_del_YN`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='라이선스코드 발급내역';


// 회원테이블 
CREATE TABLE IF NOT EXISTS `TB_MEMBER` (
	`member_idx` INT(10) NOT NULL AUTO_INCREMENT,
	`member_id` VARCHAR(100) NULL DEFAULT NULL COMMENT '회원 이메일 아이디',
	`member_name` VARCHAR(50)  NOT NULL DEFAULT '이름없음' COMMENT '회원명',
	`member_nicname` VARCHAR(100)  NOT NULL DEFAULT '닉네임없음' COMMENT '회원 닉네임',
    `member_password` VARCHAR(50) NOT NULL DEFAULT '' COMMENT '회원 비밀번호',
    `member_phone` VARCHAR(20) NULL DEFAULT NULL COMMENT '회원 연락처',
    `member_join_gubun` ENUM('W','G','A','E') NOT NULL DEFAULT 'W' COMMENT '가입구분 (W:웹가입, G:구글가입, A:애플가입, E:기타예비)',
    `member_gubun` ENUM('S','A','N','G') NOT NULL DEFAULT 'N' COMMENT '관리자구분 (S:슈퍼관리자, A:일반관리자, N:일반회원, G:게스트회원)',
    `member_reg_ip` varchar(15) DEFAULT NULL COMMENT '등록아이피',
	`member_reg_date` TIMESTAMP NOT NULL DEFAULT current_timestamp() COMMENT '가입일시',
    `member_login_date` TIMESTAMP NULL DEFAULT NULL COMMENT '마지막 로그인 일시',
	`member_del_YN` ENUM('Y','N') NOT NULL DEFAULT 'N' COMMENT '사용여부(Y:미사용, N:사용)',
	PRIMARY KEY (`member_idx`),
	INDEX `member_del_YN` (`member_del_YN`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='회원가입정보';
